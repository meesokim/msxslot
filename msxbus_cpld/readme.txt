EPM240T100을 기반으로 MSX 8bit 컴퓨터의 슬롯과 ft232h간 고속통신을 통해서 Z80 CPU 버스의 입출력을 가능하게 하도록 하는 VHDL 코드를 작성합니다.
Z80 CPU 기반 MSX 컴퓨터 슬롯은 50pin 카드엣지 커넥터를 통해서 외부 회로와 통신합니다. 주소 16비트, 데이터 8비트, RD, WR, MREQ, IORQ 신호를 통해서 Z80 CPU가 호스트가 되서 통신을 수행합니다.
WAIT 신호는 MREQ나 IORQ를 통해서 요청을 하면 데이터 전송을 끝내기 전에 시간이 필요할 경우 Z80에게 다음 명령 처리를 유보하는 기능을 하며, 이를 적극적으로 활용해야 합니다.
ft232h USB 호스트에서 Z80 버스 요청에 대해서 EPM240T100의 다음과 같이 프로토콜을 통해서 반응합니다.

Z80 -> 호스트로 명령어, 16비트 주소, 8비트 데이터 4바이트 전송
MREQ_RD: Z80 CPU가 외부 메모리의 16비트 주소의 데이터를 요청
MREQ_WR: Z80 CPU가 외부 메모리의 16비트 주소에 데이터 쓰기를 요청
IORQ_RD: Z80 CPU가 외부 I/O 16비트 주소의 데이터를 요청
IORQ_WR: Z80 CPU가 외부 I/O 16비트 주소에 데이터 쓰기를 요청

호스트 -> Z80으로 응답 시 데이터가 준비되기 전까지는 WAIT 신호로 대기
응답 데이터가 준비되기 전까지는 ft232h에 0xff를 출력, 준비가 되면 0x0을 출력
0x0을 출력한 뒤 그 다음 데이터는 MREQ_RD, IORQ_RD의 리턴값을 전송

Z80 <-> EPM240T100 <-> FT232H <-> USB 호스트